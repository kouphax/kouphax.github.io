<!DOCTYPE html>
<html><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, user-scalable=no" name="viewport"><meta content="Micro Web Frameworks in .NET 101: Anna" name="description"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Merriweather:400,700|Open+Sans:400,700" rel="stylesheet" type="text/css"><link href="/bundles/84cd5d4454d9/styles.css" rel="stylesheet" /><title>Micro Web Frameworks in .NET 101: Anna</title></head><body><div class="row"><blockquote class="warning">This post is over 6 months old.  Some details,
       especially technical, may have changed.</blockquote><div itemscope="" itemtype="http://schema.org/Article"><h1 itemprop="name">Micro Web Frameworks in .NET 101: Anna</h1><div class="post" itemprop="articleBody">
<p>It's been a while since I visited this subject (at least in my blog) and I've still to record a lot of screencasts around Nancy.  Anyway I thought I'd give a quick mention to <a href="https://github.com/jfromaniello/Anna/">Anna</a> that has just come up on my radar.  Now the project is still in the very early stages but it's possibly one of the best uses of <a href="http://msdn.microsoft.com/en-us/data/gg577609">Rx</a> and worth a quick look.  Now I am a bit rusty in the old Rx stuff so sorry if I say something stupid.</p><h2>Getting Started - Hello World</h2><p><a href="https://github.com/jfromaniello/Anna/">Anna</a> aims to be an asynchronous event-driven <span class="caps">HTTP</span> server in a similar vein to <a href="http://nodejs.org/">node.js</a>.  At it's core is the <code>HttpServer</code> object that allows us to wire up routes.</p><p>There is no configuration required - just install <a href="https://github.com/jfromaniello/Anna/">Anna</a>  from the Nuget Package Console via <code>Install-Package Anna</code> and you are good to go.  Just create a console application with the infamous <code>Program.cs</code> and a few lines of code gives you the <code>Hello World</code> solution,</p><div class="highlight"><pre><code><span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">server</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpServer</span><span class="p">(</span><span class="s">"http://localhost:1234/"</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">server</span><span class="p">.</span><span class="n">GET</span><span class="p">(</span><span class="s">"/"</span><span class="p">).</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">context</span> <span class="p">=&gt;</span> 
        <span class="n">context</span><span class="p">.</span><span class="n">Respond</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">));</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>I added the <code>Console.ReadLine()</code> to stop the console app exiting and cleaning things up.  Running the app and going to <code>http://localhost:1234</code> gives you the result.  The <code>HttpServer</code> object has a number of methods for the various <span class="caps">HTTP</span> verbs and these methods all return instances of <code>IObservable</code> which means you can subscribe to them and apply all those filters, transforms etc. the Rx offers.</p><h2>Other Anna Features</h2><p>As I said <a href="https://github.com/jfromaniello/Anna/">Anna</a>  is still in the early stages so once you grab a route there isn't a <span class="caps">MASSIVE</span> amount you can do with but respond.  Responses however are chainable so you can create an almost middleware like stack for requests e.g.</p><div class="highlight"><pre><code><span class="kt">var</span> <span class="n">route</span> <span class="p">=</span> <span class="n">server</span><span class="p">.</span><span class="n">GET</span><span class="p">(</span><span class="s">"/"</span><span class="p">);</span>
<span class="n">route</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">context</span> <span class="p">=&gt;</span> <span class="n">context</span><span class="p">.</span><span class="n">Respond</span><span class="p">(</span><span class="s">"Hello "</span><span class="p">));</span>
<span class="n">route</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">context</span> <span class="p">=&gt;</span> <span class="n">context</span><span class="p">.</span><span class="n">Respond</span><span class="p">(</span><span class="s">"World"</span><span class="p">));</span>
</code></pre></div>
<p>This gives you the same output as the original Hello World sample.</p><p>But from what I can see thats about as far as you can get.  In <a href="http://nodejs.org/">node.js</a> there is a framework called <a href="http://senchalabs.github.com/connect/">Connect</a> now I'm not sure if <a href="https://github.com/jfromaniello/Anna/">Anna</a>  is intending to go in this sort of direction but I think it could be moulded into something like this with a bit of <span class="caps">TLC</span>.  The problem is at the minute I don't see any sort of object passed along the subscription chain e.g. a <code>dynamic</code> bag or something. I don't even know how to easily manage response headers.</p><h3>Routes and Route Fragments</h3><p><a href="https://github.com/jfromaniello/Anna/">Anna</a>  supports creating different routes including routes with dynamic sections <code>/name/{name}</code> that are used to populated a <code>UriFragments</code> property,</p><div class="highlight"><pre><code><span class="n">server</span><span class="p">.</span><span class="n">GET</span><span class="p">(</span><span class="s">"/hello/{name}"</span><span class="p">).</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">context</span> <span class="p">=&gt;</span> <span class="n">context</span><span class="p">.</span><span class="n">Respond</span><span class="p">(</span>
    <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">"Hello {0}"</span><span class="p">,</span> <span class="n">context</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">UriArguments</span><span class="p">.</span><span class="n">name</span><span class="p">)));</span>
</code></pre></div>
<h3>Conditional Routes</h3><p>Thanks to the power of Rx and Linq it is possible to create conditional routes an create chains that have pre-response checks.  For example we can have a route that only triggers a response if the QueryString has a secret parameter.</p><div class="highlight"><pre><code><span class="kt">var</span> <span class="n">route</span> <span class="p">=</span> <span class="n">server</span><span class="p">.</span><span class="n">GET</span><span class="p">(</span><span class="s">"/"</span><span class="p">);</span>

<span class="n">route</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">context</span> <span class="p">=&gt;</span> <span class="n">context</span><span class="p">.</span><span class="n">Respond</span><span class="p">(</span><span class="s">"&lt;h1&gt;Hello World&lt;/h1&gt;"</span><span class="p">));</span>
<span class="n">route</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">ctx</span> <span class="p">=&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">QueryString</span><span class="p">.</span><span class="n">secret</span> <span class="p">==</span> <span class="s">"letmein"</span><span class="p">)</span>
     <span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">ctx</span> <span class="p">=&gt;</span> <span class="n">ctx</span><span class="p">.</span><span class="n">Respond</span><span class="p">(</span><span class="s">"&lt;h2&gt;Secret Message&lt;/h2&gt;"</span><span class="p">));</span>
</code></pre></div>
<p></p><p>So if you hit <code>http://localhost:1234/</code> you get Hello World.  Hit that again with the param <code>?/secret=letmein</code> and you get the super secret message.</p><h2>Conclusion</h2><p>Thats about it for now but I think I'll be keeping an eye on this project and see were it goes.  Even though it's still early days I like the concept behind the library and the fresh approach it's taking.  I'll push some of my sample code up to Github and update this post in the next few days.  In the meantime Jose the creator of Anna has <a href="http://joseoncode.com/2011/06/17/event-driven-http-server-in-c-with-rx-and-httplistener/">some nice examples</a> of Rx based HttpServer stuff on his blog featuring a long polling example.</p></div><a class="twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fyobriefca.se%2Fblog%2F2011%2F06%2F21%2Fmicro-web-frameworks-in-net-101-anna%2F&amp;text=Micro%20Web%20Frameworks%20in%20.NET%20101%3A%20Anna&amp;via=kouphax" itemprop="discussionUrl" target="_blank">Tweet This</a><div class="dater"><time datetime="21-06-2011" itemprop="datePublished">June 21, 2011</time></div><div class="categories">Published in <a href="/categories/dot-net/">.NET</a> on June 21, 2011</div></div></div><div class="homer"><a href="/"><i class="icon-briefcase" style="font-size:32px;"></i></a></div><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19143623-5', 'yobriefca.se');
  ga('send', 'pageview');</script></body></html>