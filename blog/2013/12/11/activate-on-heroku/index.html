<!DOCTYPE html>
<html><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, user-scalable=no" name="viewport"><meta content="Activate on Heroku" name="description"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Merriweather:400,700|Open+Sans:400,700" rel="stylesheet" type="text/css"><link href="/bundles/84cd5d4454d9/styles.css" rel="stylesheet" /><title>Activate on Heroku</title></head><body><div class="row"><blockquote class="warning">This post is over 6 months old.  Some details,
       especially technical, may have changed.</blockquote><div itemscope="" itemtype="http://schema.org/Article"><h1 itemprop="name">Activate on Heroku</h1><div class="post" itemprop="articleBody"><p><a href="http://activate-framework.org/">Activate</a> is an object persistence framework for Scala. Unlike an ORM that openly tries to map DB concepts to objects <a href="http://activate-framework.org/">Activate</a> goes up a further level making the persistence aspect almost completely transparent. You work with objects and in doing so persistence happens as a side effect. For example given a class that extends the <code>Entity</code> trait,</p>
<pre class="highlight"><code class="scala"><span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="k">var</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">var</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</code></pre><p>We can create <strong>and persist</strong> this instance like so</p>
<pre class="highlight"><code class="scala"><span class="n">transactional</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">"James"</span><span class="o">,</span> <span class="mi">33</span><span class="o">)</span>
<span class="o">}</span>
</code></pre><p>Updating it will result in the persisted state of the instance being mutated as well. <a href="http://activate-framework.org/">Activate</a> uses the concurrency model of <a href="http://en.wikipedia.org/wiki/Software_transactional_memory">Software Transactional Memory</a> at its core. As there is often some discrepencies between the conceptual model the database domain and objects <a href="http://activate-framework.org/">Activate</a> uses <code>Dialects</code> that handle the translation between the two (for example persisting an object with a <code>List</code> of <code>Int</code>s in a relational database that doesn't support array columns). In fact persistence is abstracted suitably that it becomes completely pluggable - use a document store like Mongo or a relational store like Postgres. <a href="http://activate-framework.org/">Activate</a> attempts to make this irrelevant.</p><p>I want to caveat all of this with the fact I'm not an <a href="http://activate-framework.org/">Activate</a> expert. I've succesfully used it in small volume projects and it's allowed me to be pretty productive. Which leads me to onto using it with <a href="http://www.heroku.com/">Heroku</a>.</p><h2>Adapting Activate for Heroku</h2><p>I have used Activate on 2 projects hosted on Heroku recently and I wanted to share a snippet that I wrote for the first one that I've found useful in the second. When you use Activate you need to create a <code>Context</code> that configures Activate for your application domain. One thing you need to set is the <code>storage</code> mechanism. On Heroku I used the provided Postgres instance which is made available to your application via the <code>DATABASE_URL</code> environment variable. So in JDBC based applications you need to coerce this into a JDBC connection string. To do this in Activate I used the code below which may come in useful for people wanting to do the same thing.</p>
<pre class="highlight"><code class="scala"><span class="k">object</span> <span class="nc">PersistenceContext</span> <span class="k">extends</span> <span class="nc">ActivateContext</span> <span class="k">with</span> <span class="nc">Config</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">storage</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PooledJdbcRelationalStorage</span> <span class="o">{</span>
        <span class="k">val</span> <span class="n">uri</span>        <span class="k">=</span> <span class="k">new</span> <span class="nc">URI</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="n">getenv</span><span class="o">(</span><span class="s">"DATABASE_URL"</span><span class="o">))</span>
        <span class="k">val</span> <span class="n">jdbcDriver</span> <span class="k">=</span> <span class="s">"org.postgresql.Driver"</span>
        <span class="k">val</span> <span class="n">user</span>       <span class="k">=</span> <span class="n">uri</span><span class="o">.</span><span class="n">getUserInfo</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">":"</span><span class="o">).</span><span class="n">head</span>
        <span class="k">val</span> <span class="n">password</span>   <span class="k">=</span> <span class="n">uri</span><span class="o">.</span><span class="n">getUserInfo</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">":"</span><span class="o">).</span><span class="n">last</span>
        <span class="k">val</span> <span class="n">url</span>        <span class="k">=</span> <span class="n">s</span><span class="s">"jdbc:postgresql://${uri.getHost()}:${uri.getPort()}${uri.getPath()}?ssl=true&amp;sslfactory=org.postgresql.ssl.NonValidatingFactory"</span>
        <span class="k">val</span> <span class="n">dialect</span>    <span class="k">=</span> <span class="n">postgresqlDialect</span>
      <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><a class="twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fyobriefca.se%2Fblog%2F2013%2F12%2F11%2Factivate-on-heroku%2F&amp;text=Activate%20on%20Heroku&amp;via=kouphax" itemprop="discussionUrl" target="_blank">Tweet This</a><div class="dater"><time datetime="11-12-2013" itemprop="datePublished">December 11, 2013</time></div><div class="categories">Published in <a href="/categories/scala/">Scala</a> on December 11, 2013</div></div></div><div class="homer"><a href="/"><i class="icon-briefcase" style="font-size:32px;"></i></a></div></body></html>
