<!DOCTYPE html>
<html><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, user-scalable=no" name="viewport"><meta content="Basic ClojureScript Setup" name="description"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Merriweather:400,700|Open+Sans:400,700" rel="stylesheet" type="text/css"><link href="/bundles/84cd5d4454d9/styles.css" rel="stylesheet" /><title>Basic ClojureScript Setup</title></head><body><div class="row"><blockquote class="warning">This post is over 6 months old.  Some details,
       especially technical, may have changed.</blockquote><div itemscope="" itemtype="http://schema.org/Article"><h1 itemprop="name">Basic ClojureScript Setup</h1><div class="post" itemprop="articleBody"><p>ClojureScript is a bit of an awkward one to get into. If Clojure isn't your natural language then you may well find the clojarian setup and the long compilation times a bit of a frustration. Even if you're accustomed to the REPL based development approach that fits so well with Clojure there is still a certain amount of friction to be had with ClojureScript.</p><p>Recently a strong desire to play with and better understand <a href="https://github.com/clojure/core.async"><code>core.async</code></a> in ClojureScript I decided to try and put together a lightweight workflow. In doing so I ended up producing a Clojure library (<a href="http://yobriefca.se/primrose/">primrose</a>) and a Leiningen plugin (<a href="http://yobriefca.se/lein-cooper/">lein-cooper</a>) to better support this workflow.</p><p>It's probably a sure sign that you are doing something wrong when you feel you need to create a bunch of developer focused tools to support a workflow for an already established ecosystem but you gotta do, what you gotta do.</p><p>Here goes.</p><h2>Starting point</h2><p>ClojureScript projects are still Clojure projects and so there are few bits and pieces that you need to wire up a basic empty project. You've got your <code>project.clj</code>, the <a href="https://github.com/emezeske/lein-cljsbuild"><code>lein-cljsbuild</code></a> plugin for compiling ClojureScript to JavaScript and (at the very least) an <code>index.html</code> for bringing everything together.</p><p>Thankfully David Nolen has you covered. <a href="https://github.com/swannodette/mies">Mies</a> is a very basic ClojureScript project template so getting up and running is a matter of,</p>
<pre class="highlight"><code class="bash">lein new mies &lt;project name&gt;
<span class="nb">cd</span> &lt;project name&gt;
</code></pre><p>At this point you are good to go. To compile the ClojureScript you can run,</p>
<pre class="highlight"><code class="bash">lein cljsbuild once
</code></pre><p>If you open <code>index.html</code> and view the developer console you should see some predictable output. Alternatively if you run,</p>
<pre class="highlight"><code class="bash">lein cljsbuild auto
</code></pre><p>The plugin will watch your project sources and recompile everything when changes are made. This is significantly faster that manually compiling every time as compilation is incremental. So instead of 10s of seconds for each compile you'll be getting sub-second compilations.</p><h2>Ajax</h2><p>When you view HTML files via <code>file://</code> you won't be able to, at least by default, make ajax calls (due to security concerns such as <a href="https://en.wikipedia.org/wiki/Same-origin_policy">Same-origin policy</a>).</p><p>To fix this you'll want to serve your <code>index.html</code> from a web server. You could go with <code>python -m simplehttpserver</code> as many often do but if you want to keep everything under the same roof (Clojure/Leiningen) then I'd recommend <a href="https://github.com/tailrecursion/lein-simpleton"><code>lein-simpleton</code></a> - a Leiningen plugin for serving static files from the current directory. If you add <code>lein-simpleton</code> to the projects <code>project.clj</code> file,</p>
<pre class="highlight"><code class="clojure"><span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">lein-cljsbuild</span> <span class="s">"1.0.2"</span><span class="p">]</span>
          <span class="p">[</span><span class="nv">lein-simpleton</span> <span class="s">"1.3.0"</span><span class="p">]]</span>
</code></pre><p>You can now run <code>lein simpleton &lt;port&gt;</code> to start serving static files (your <code>index.html</code>). Alternatively if you have actual server side code in the same project you can replace <code>lein-simpleton</code> with <a href="https://github.com/weavejester/lein-ring"><code>lein-ring</code></a>.</p><h2>Two for One</h2><p>So now if you run both</p>
<ol>
  <li><code>lein cljsbuild auto</code></li>
  <li><code>lein simpleton &lt;port&gt;</code></li>
</ol><p>You have a dynamic(ish) environment for working and testing your ClojureScript work.</p><p>Problem is I don't like having multiple windows open for long running processes and we now have 2. Ruby has a nice answer for this which plays very well with <a href="http://heroku.com">Heroku</a> - <a href="https://github.com/ddollar/foreman">Foreman</a>. Foreman takes a file (<code>Procfile</code>) that contains a list of named command line processes and runs them. These processes are supposed to be long running (like <code>simpleton</code> and <code>cljsbuild auto</code>) and Foreman merges the output of these files into a single stream that makes development and debugging a bit easier.</p><p>Again if you want to keep this sort of thing all under one roof I've thrown together a simple plugin for ingesting a <code>Procfile</code> and doing what Foreman does - in Leiningen.</p><h2>lein-cooper</h2><p><a href="https://github.com/kouphax/lein-cooper"><code>lein-cooper</code></a> gives you that Foreman feeling. So lets add this as a plugin.</p>
<pre class="highlight"><code class="clojure"><span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">lein-cljsbuild</span> <span class="s">"1.0.2"</span><span class="p">]</span>
          <span class="p">[</span><span class="nv">lein-simpleton</span> <span class="s">"1.3.0"</span><span class="p">]</span>
          <span class="p">[</span><span class="nv">lein-cooper</span> <span class="s">"0.0.1"</span><span class="p">]]</span>
</code></pre><p>Now we can create a <code>Procfile</code> at the root of our project to run our two commands.</p>
<pre class="highlight"><code>web: lein simpleton
cljs: lein cljsbuild auto
</code></pre><p>Now if we run <code>lein cooper</code> we will have single call to start up our dynamic(ish) environment for working with ClojureScript. Once you are done just <code>CTRL-C</code> the terminal and everything will shutdown cleanly.</p><h2>Summing Up</h2><p>So we now have a very basic project setup that will allow us to tinker with ClojureScript, make Ajax calls, edit code and cleanly automate away all the stopping and restarting and problematic debugging. It's not quite the REPL driven style of a typical Clojure project but it's minimal enough to try a few smaller scale things.</p></div><a class="twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fyobriefca.se%2Fblog%2F2014%2F05%2F30%2Fbasic-clojurescript-setup%2F&amp;text=Basic%20ClojureScript%20Setup&amp;via=kouphax" itemprop="discussionUrl" target="_blank">Tweet This</a><div class="dater"><time datetime="30-05-2014" itemprop="datePublished">May 30, 2014</time></div><div class="categories">Published in <a href="/categories/clojure/">Clojure</a> <a href="/categories/clojurescript/">ClojureScript</a> on May 30, 2014</div></div></div><div class="homer"><a href="/"><i class="icon-briefcase" style="font-size:32px;"></i></a></div><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19143623-5', 'yobriefca.se');
  ga('send', 'pageview');</script></body></html>