<!DOCTYPE html>
<html><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, user-scalable=no" name="viewport"><meta content="Working with Play apps in the Console" name="description"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Merriweather:400,700|Open+Sans:400,700" rel="stylesheet" type="text/css"><link href="/bundles/84cd5d4454d9/styles.css" rel="stylesheet" /><title>Working with Play apps in the Console</title></head><body><div class="row"><blockquote class="warning">This post is over 6 months old.  Some details,
       especially technical, may have changed.</blockquote><div itemscope="" itemtype="http://schema.org/Article"><h1 itemprop="name">Working with Play apps in the Console</h1><div class="post" itemprop="articleBody"><p>Having spent a fair amount of time working with Clojure in the last 6 months I've become rather accustomed to the REPL driven development approach. If you're unfamiliar with this approach I recommend reading/viewing Jay Fields <a href="http://blog.jayfields.com/2014/01/repl-driven-development.html">post on the topic</a>. Long story short RDD involves writing a small bits of code and executing them immediately. This gives you immediate feedback without having to write tests or start an entire system each time. You can of course make your REPL based experimentation more concrete by saving your work off as a set of tests once your code has settled down a bit.</p><p>Like Clojure, and unlike Java, Scala supports the concept of REPL driven development and I've been using it more often since my exposure to its charms in Clojure. Of course Scala syntax is a lot meatier (and I do mean a lot) than Clojure syntax so there is a bit more friction but every now and again its faster when you just want to poke around a concept or idea. </p><p>A common example when working with <a href="http://playframework.com">Play</a> is querying the application database with Anorm. The one problem here is that to use Anorm and the Play provided extensions you need to have a running Play instance that it can extract configuration values from. </p><p>For example if we tried to get all the users from a database we could write something like this via the console (<code>sbt console</code> or <code>activator console</code> in the root of our project)</p>
<pre class="highlight"><code class="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">play.api.db._</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">anorm._</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span> <span class="nc">SQL</span><span class="s">"SELECT * FROM users"</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">mapUser</span><span class="o">).</span><span class="n">list</span><span class="o">()</span> <span class="o">}</span>
</code></pre><p>But this would result in an error.</p>
<pre class="highlight"><code class="scala"><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">RuntimeException</span><span class="k">:</span> <span class="kt">There</span> <span class="kt">is</span> <span class="kt">no</span> <span class="kt">started</span> <span class="kt">application</span>
  <span class="n">at</span> <span class="n">scala</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">package$</span><span class="o">.</span><span class="n">error</span><span class="o">(</span><span class="n">package</span><span class="o">.</span><span class="n">scala</span><span class="k">:</span><span class="err">27</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">play</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="nc">Play$$anonfun$current$1</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="nc">Play</span><span class="o">.</span><span class="n">scala</span><span class="k">:</span><span class="err">71</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">play</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="nc">Play$$anonfun$current$1</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="nc">Play</span><span class="o">.</span><span class="n">scala</span><span class="k">:</span><span class="err">71</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">scala</span><span class="o">.</span><span class="nc">Option</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="nc">Option</span><span class="o">.</span><span class="n">scala</span><span class="k">:</span><span class="err">120</span><span class="o">)</span>
  <span class="n">at</span> <span class="n">play</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="nc">Play</span><span class="n">$</span><span class="o">.</span><span class="n">current</span><span class="o">(</span><span class="nc">Play</span><span class="o">.</span><span class="n">scala</span><span class="k">:</span><span class="err">71</span><span class="o">)</span>
  <span class="o">...</span> <span class="mi">43</span> <span class="n">elided</span>
</code></pre><p>Bummer. Thankfully Play provides a quick way to stand up an running instance which can be used in the console</p>
<pre class="highlight"><code class="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">new</span> <span class="n">play</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="nc">StaticApplication</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">File</span><span class="o">(</span><span class="s">"."</span><span class="o">))</span>
<span class="o">[</span><span class="kt">info</span><span class="o">]</span> <span class="n">play</span> <span class="o">-</span> <span class="n">database</span> <span class="o">[</span><span class="kt">default</span><span class="o">]</span> <span class="n">connected</span> <span class="n">at</span> <span class="n">jdbc</span><span class="k">:</span><span class="kt">h2:file:./data/db</span>
<span class="o">[</span><span class="kt">info</span><span class="o">]</span> <span class="n">play</span> <span class="o">-</span> <span class="nc">Application</span> <span class="n">started</span> <span class="o">(</span><span class="nc">Prod</span><span class="o">)</span>
<span class="n">res18</span><span class="k">:</span> <span class="kt">play.core.StaticApplication</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="nc">StaticApplication</span><span class="k">@</span><span class="mi">22</span><span class="n">a730f2</span>
</code></pre><p>Now if we try our query again</p>
<pre class="highlight"><code class="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span> <span class="nc">SQL</span><span class="s">"SELECT * FROM users"</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">mapUser</span><span class="o">).</span><span class="n">list</span><span class="o">()</span> <span class="o">}</span>
<span class="n">res19</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">String</span>,<span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="n">username</span> <span class="o">-&gt;</span> <span class="n">kouphax</span><span class="o">,</span> <span class="n">password</span> <span class="o">-&gt;</span> <span class="nc">JHGW$FSWF$KJJK$3231</span><span class="o">))</span>
</code></pre><p>To be super clean we can even stop the running instance</p>
<pre class="highlight"><code class="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">play</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="nc">Play</span><span class="o">.</span><span class="n">stop</span><span class="o">()</span>
</code></pre><p><code>StaticApplication</code> isn't perfect. For instance it will start your application in production mode but for my needs this has been acceptable. If you do want to provide greater control over how your application is started then look no further than the <code>StaticApplication</code> source.</p>
<pre class="highlight"><code class="scala"><span class="k">class</span> <span class="nc">StaticApplication</span><span class="o">(</span><span class="n">applicationPath</span><span class="k">:</span> <span class="kt">File</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">ApplicationProvider</span> <span class="o">{</span>

  <span class="k">val</span> <span class="n">application</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DefaultApplication</span><span class="o">(</span><span class="n">applicationPath</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="n">getClass</span><span class="o">.</span><span class="n">getClassLoader</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">Mode</span><span class="o">.</span><span class="nc">Prod</span><span class="o">)</span>

  <span class="nc">Play</span><span class="o">.</span><span class="n">start</span><span class="o">(</span><span class="n">application</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">get</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="n">application</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">path</span> <span class="k">=</span> <span class="n">applicationPath</span>
<span class="o">}</span>
</code></pre><p>Using this knowledge you could create your own <code>application</code> instance using <code>DefaultApplication</code> and ask Play to start it using <code>Play.start(application)</code>. </p></div><a class="twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fyobriefca.se%2Fblog%2F2014%2F07%2F11%2Fworking-with-play-apps-in-the-console%2F&amp;text=Working%20with%20Play%20apps%20in%20the%20Console&amp;via=kouphax" itemprop="discussionUrl" target="_blank">Tweet This</a><div class="dater"><time datetime="11-07-2014" itemprop="datePublished">July 11, 2014</time></div><div class="categories">Published in <a href="/categories/scala/">Scala</a> on July 11, 2014</div></div></div><div class="homer"><a href="/"><i class="icon-briefcase" style="font-size:32px;"></i></a></div></body></html>
